@model IEnumerable<BTL_QlBi_a.Models.Entities.ChamCong>

<div class="chamcong-header" style="margin-bottom: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h4 style="margin: 0; font-size: 16px; color: #1a1a2e;">
            📅 Chấm công tháng @ViewBag.Thang/@ViewBag.Nam
        </h4>
        <div style="display: flex; gap: 8px;">
            <button class="btn-nav" onclick="changeMonth(-1)">◀️</button>
            <button class="btn-nav" onclick="changeMonth(1)">▶️</button>
        </div>
    </div>

    <!-- Thống kê tổng quan -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
        <div class="stat-box" style="background: linear-gradient(135deg, #667eea, #764ba2);">
            <div class="stat-value" style="color: white;">@Model.Count()</div>
            <div class="stat-label" style="color: rgba(255,255,255,0.9);">Ngày làm</div>
        </div>
        <div class="stat-box" style="background: linear-gradient(135deg, #28a745, #20c997);">
            <div class="stat-value" style="color: white;">@Model.Sum(cc => cc.SoGioLam ?? 0).ToString("F1")h</div>
            <div class="stat-label" style="color: rgba(255,255,255,0.9);">Tổng giờ</div>
        </div>
        <div class="stat-box" style="background: linear-gradient(135deg, #dc3545, #fd7e14);">
            <div class="stat-value" style="color: white;">@Model.Count(cc => cc.TrangThai == BTL_QlBi_a.Models.Entities.TrangThaiChamCong.DiTre)</div>
            <div class="stat-label" style="color: rgba(255,255,255,0.9);">Đi trễ</div>
        </div>
    </div>
</div>

<!-- Danh sách chấm công -->
<div style="max-height: 400px; overflow-y: auto;">
    @if (Model != null && Model.Any())
    {
        <table class="data-table" style="font-size: 12px;">
            <thead>
                <tr>
                    <th width="25%">Ngày</th>
                    <th width="20%">Giờ vào</th>
                    <th width="20%">Giờ ra</th>
                    <th width="15%">Số giờ</th>
                    <th width="20%">Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var cc in Model.OrderByDescending(c => c.Ngay))
                {
                    <tr>
                        <td>
                            <strong>@cc.Ngay.ToString("dd/MM/yyyy")</strong>
                            <br>
                            <small style="color: #6c757d;">@cc.Ngay.ToString("dddd", new System.Globalization.CultureInfo("vi-VN"))</small>
                        </td>
                        <td>
                            @if (cc.GioVao.HasValue)
                            {
                                <span>@cc.GioVao.Value.ToString("HH:mm")</span>
                            }
                            else
                            {
                                <span style="color: #6c757d;">--:--</span>
                            }
                        </td>
                        <td>
                            @if (cc.GioRa.HasValue)
                            {
                                <span>@cc.GioRa.Value.ToString("HH:mm")</span>
                            }
                            else
                            {
                                <span style="color: #6c757d;">--:--</span>
                            }
                        </td>
                        <td>
                            @if (cc.SoGioLam.HasValue)
                            {
                                <strong style="color: #667eea;">@cc.SoGioLam.Value.ToString("F1")h</strong>
                            }
                            else
                            {
                                <span style="color: #6c757d;">0h</span>
                            }
                        </td>
                        <td>
                            @switch (cc.TrangThai)
                            {
                                case BTL_QlBi_a.Models.Entities.TrangThaiChamCong.DungGio:
                                    <span class="badge badge-success">Đúng giờ</span>
                                    break;
                                case BTL_QlBi_a.Models.Entities.TrangThaiChamCong.DiTre:
                                    <span class="badge badge-warning">Đi trễ</span>
                                    break;
                                case BTL_QlBi_a.Models.Entities.TrangThaiChamCong.VeSom:
                                    <span class="badge badge-info">Về sớm</span>
                                    break;
                                case BTL_QlBi_a.Models.Entities.TrangThaiChamCong.Vang:
                                    <span class="badge badge-danger">Vắng</span>
                                    break;
                                case BTL_QlBi_a.Models.Entities.TrangThaiChamCong.CaThem:
                                    <span class="badge badge-primary">Ca thêm</span>
                                    break;
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="empty-state">
            <div class="empty-icon">📅</div>
            <p class="empty-text">Chưa có dữ liệu chấm công tháng này</p>
        </div>
    }
</div>

<script>
    const currentMaNV = @ViewBag.MaNV;
    let currentThang = @ViewBag.Thang;
    let currentNam = @ViewBag.Nam;

    async function changeMonth(delta) {
        currentThang += delta;

        if (currentThang > 12) {
            currentThang = 1;
            currentNam++;
        } else if (currentThang < 1) {
            currentThang = 12;
            currentNam--;
        }

        try {
            const response = await fetch(`/NhanVien/ChamCongNhanVien?maNV=${currentMaNV}&thang=${currentThang}&nam=${currentNam}`);
            const html = await response.text();

            // Update modal content
            document.getElementById('modalContent').innerHTML = html;
        } catch (error) {
            console.error('Error:', error);
            alert('❌ Có lỗi khi tải dữ liệu: ' + error.message);
        }
    }
</script>

<style>
    .btn-nav {
        width: 35px;
        height: 35px;
        border: none;
        background: #f8f9fa;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
    }

        .btn-nav:hover {
            background: #e9ecef;
            transform: scale(1.05);
        }

    .stat-box {
        padding: 15px;
        border-radius: 10px;
        text-align: center;
    }

    .stat-value {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 11px;
        font-weight: 600;
    }

    .badge {
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 10px;
        font-weight: 600;
        display: inline-block;
    }

    .badge-success {
        background: #28a745;
        color: white;
    }

    .badge-warning {
        background: #ffc107;
        color: #000;
    }

    .badge-info {
        background: #17a2b8;
        color: white;
    }

    .badge-danger {
        background: #dc3545;
        color: white;
    }

    .badge-primary {
        background: #667eea;
        color: white;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

        .data-table thead {
            background: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .data-table th {
            padding: 10px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 10px;
            font-size: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
    }

    .empty-icon {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    .empty-text {
        font-size: 14px;
    }
</style>