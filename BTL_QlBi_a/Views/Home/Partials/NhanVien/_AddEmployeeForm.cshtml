@{
    var danhSachNhom = ViewBag.DanhSachNhom as List<BTL_QlBi_a.Models.Entities.NhomQuyen>;
}

<form id="addEmployeeForm" onsubmit="submitAddEmployee(event)">
    <div class="form-row">
        <div class="form-group">
            <label class="form-label">Họ tên *</label>
            <input type="text" class="form-control" name="TenNV" required placeholder="Nhập họ tên nhân viên">
        </div>
        <div class="form-group">
            <label class="form-label">Số điện thoại</label>
            <input type="tel" class="form-control" name="SDT" pattern="[0-9]{10}" placeholder="0xxxxxxxxx">
            <small class="form-hint">Nhập 10 chữ số</small>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label class="form-label">Chức vụ *</label>
            <select class="form-control" name="MaNhom" required>
                <option value="">-- Chọn chức vụ --</option>
                <option value="1">Admin</option>
                <option value="2">Quản lý</option>
                <option value="3">Thu ngân</option>
                <option value="4">Phục vụ</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">Ca làm việc *</label>
            <select class="form-control" name="CaMacDinh" required>
                <option value="Sang">Sáng (7h - 15h)</option>
                <option value="Chieu">Chiều (15h - 23h)</option>
                <option value="Toi">Tối (19h - 3h)</option>
            </select>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label class="form-label">Lương cơ bản (VNĐ) *</label>
            <input type="number" class="form-control" name="LuongCoBan" value="5000000" required min="0" step="100000">
        </div>
        <div class="form-group">
            <label class="form-label">Phụ cấp (VNĐ)</label>
            <input type="number" class="form-control" name="PhuCap" value="0" min="0" step="100000">
        </div>
    </div>

    <div class="form-group">
        <label class="form-label">Mật khẩu *</label>
        <input type="password" class="form-control" name="MatKhau" required minlength="6" placeholder="Tối thiểu 6 ký tự">
        <small class="form-hint">Mật khẩu dùng để đăng nhập hệ thống</small>
    </div>

    <div class="info-card" style="margin-top: 15px; background: #e8f5e9; border-left: 4px solid #28a745;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="2" style="float: left; margin-right: 10px;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <p style="font-size: 12px; color: #2e7d32; margin: 0;">
            Sau khi thêm nhân viên, bạn có thể cập nhật Face ID và vân tay từ trang chi tiết nhân viên.
        </p>
    </div>

    <div class="action-buttons" style="margin-top: 20px;">
        <button type="submit" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Thêm nhân viên
        </button>
        <button type="button" class="btn btn-secondary" onclick="closeModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            Hủy
        </button>
    </div>
</form>

<script>
    async function submitAddEmployee(event) {
        event.preventDefault();

        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());

        // Convert CaMacDinh to proper enum value
        if (data.CaMacDinh === 'Sang') data.CaMacDinh = 0;
        else if (data.CaMacDinh === 'Chieu') data.CaMacDinh = 1;
        else if (data.CaMacDinh === 'Toi') data.CaMacDinh = 2;

        // Convert numeric fields
        data.MaNhom = parseInt(data.MaNhom);
        data.LuongCoBan = parseFloat(data.LuongCoBan);
        data.PhuCap = parseFloat(data.PhuCap);

        try {
            const response = await fetch('/NhanVien/Create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.message || 'Không thể thêm nhân viên');
            }

            alert('Thêm nhân viên thành công!');
            closeModal();
            location.reload();
        } catch (error) {
            console.error('Error creating employee:', error);
            alert(error.message || 'Không thể thêm nhân viên. Vui lòng thử lại.');
        }
    }
</script>

<style>
    .form-hint {
        display: block;
        margin-top: 4px;
        font-size: 11px;
        color: #6c757d;
    }

    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
</style>