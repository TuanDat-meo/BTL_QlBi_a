@model BTL_QlBi_a.Models.Entities.BanBia

<div class="ban-form-wrapper">
    <div class="form-header">
        <h3 class="form-title">✏️ Chỉnh sửa bàn: @Model.TenBan</h3>
        <button class="btn-close-form" onclick="BanBiaManager.closeModal()">✖</button>
    </div>

    <form id="formChinhSuaBan" class="ban-form" enctype="multipart/form-data" onsubmit="event.preventDefault(); BanBiaManager.submitEdit(@Model.MaBan);">
        <input type="hidden" id="maBan" name="maBan" value="@Model.MaBan" />

        <div class="form-body-scroll">
            <div class="form-section">
                <h4 class="section-subtitle">📋 Thông tin cơ bản</h4>

                <div class="form-group">
                    <label class="form-label">Tên bàn <span class="required">*</span></label>
                    <input type="text"
                           class="form-control"
                           id="tenBan"
                           name="tenBan"
                           value="@Model.TenBan"
                           required />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Loại bàn <span class="required">*</span></label>
                        <select class="form-control" id="maLoai" name="maLoai" required>
                            @foreach (var loai in ViewBag.LoaiBan)
                            {
                                <option value="@loai.MaLoai" selected="@(loai.MaLoai == Model.MaLoai)">
                                    @loai.TenLoai - @loai.GiaGio.ToString("N0")đ/h
                                </option>
                            }
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Khu vực <span class="required">*</span></label>
                        <select class="form-control" id="maKhuVuc" name="maKhuVuc" required>
                            @foreach (var kv in ViewBag.KhuVuc)
                            {
                                <option value="@kv.MaKhuVuc" selected="@(kv.MaKhuVuc == Model.MaKhuVuc)">
                                    @kv.TenKhuVuc
                                </option>
                            }
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Trạng thái</label>
                    <div class="status-display">
                        @{
                            var statusClass = Model.TrangThai switch
                            {
                                BTL_QlBi_a.Models.Entities.TrangThaiBan.Trong => "status-available",
                                BTL_QlBi_a.Models.Entities.TrangThaiBan.DangChoi => "status-occupied",
                                BTL_QlBi_a.Models.Entities.TrangThaiBan.DaDat => "status-reserved",
                                _ => ""
                            };

                            var statusText = Model.TrangThai switch
                            {
                                BTL_QlBi_a.Models.Entities.TrangThaiBan.Trong => "Trống",
                                BTL_QlBi_a.Models.Entities.TrangThaiBan.DangChoi => "Đang chơi",
                                BTL_QlBi_a.Models.Entities.TrangThaiBan.DaDat => "Đã đặt",
                                _ => Model.TrangThai.ToString()
                            };
                        }
                        <span class="status-badge-large @statusClass">@statusText</span>
                    </div>
                    <p class="form-help">Trạng thái bàn được cập nhật tự động khi sử dụng</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Ghi chú</label>
                    <textarea class="form-control"
                              id="ghiChu"
                              name="ghiChu"
                              rows="3">@Model.GhiChu</textarea>
                </div>
            </div>

            <div class="form-section">
                <h4 class="section-subtitle">🖼️ Hình ảnh bàn</h4>

                @if (!string.IsNullOrEmpty(Model.HinhAnh))
                {
                    <div class="current-image">
                        <p class="image-label">Hình ảnh hiện tại:</p>
                        <img src="@Url.Content($"~/asset/img/{Model.HinhAnh}")" alt="Current" class="current-img" />
                    </div>
                }

                <div class="image-upload-area" id="imageUploadArea">
                    <input type="file"
                           id="hinhAnhMoi"
                           name="hinhAnhMoi"
                           accept="image/*"
                           style="display: none;"
                           onchange="BanBiaManager.previewImage(this)" />

                    <div class="upload-placeholder" id="uploadPlaceholder" onclick="document.getElementById('hinhAnhMoi').click()">
                        <div class="upload-icon">📷</div>
                        <p class="upload-text">Click để thay đổi hình ảnh</p>
                        <p class="upload-hint">Để trống nếu không muốn thay đổi</p>
                    </div>

                    <div class="image-preview" id="imagePreview" style="display: none;">
                        <img id="previewImg" src="" alt="Preview" />
                        <button type="button" class="btn-remove-image" onclick="BanBiaManager.removeImage()">
                            🗑️ Xóa ảnh mới
                        </button>
                    </div>
                </div>
            </div>

            @if (Model.TrangThai == BTL_QlBi_a.Models.Entities.TrangThaiBan.Trong)
            {
                <div class="form-section danger-zone">
                    <h4 class="section-subtitle">⚠️ Vùng nguy hiểm</h4>
                    <p class="danger-text">Xóa bàn này sẽ không thể khôi phục. Chỉ xóa khi bàn chưa có lịch sử sử dụng.</p>
                    <button type="button" class="btn btn-danger" onclick="BanBiaManager.deleteBan(@Model.MaBan)">
                        🗑️ Xóa bàn này
                    </button>
                </div>
            }
        </div>

        <div class="form-footer">
            <button type="button" class="btn btn-secondary" onclick="BanBiaManager.closeModal()">
                ❌ Hủy
            </button>
            <button type="submit" class="btn btn-success">
                ✅ Lưu thay đổi
            </button>
        </div>
    </form>
</div>

<style>
    .status-display {
        padding: 15px;
        background: white;
        border-radius: 8px;
        text-align: center;
    }

    .status-badge-large {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 20px;
        font-size: 16px;
        font-weight: 700;
    }

        .status-badge-large.status-available {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }

        .status-badge-large.status-occupied {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        .status-badge-large.status-reserved {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #f59e0b;
        }

    .form-help {
        font-size: 12px;
        color: #6c757d;
        margin: 8px 0 0 0;
        font-style: italic;
    }

    .current-image {
        margin-bottom: 20px;
    }

    .image-label {
        font-weight: 600;
        margin-bottom: 10px;
        color: #2c3e50;
    }

    .current-img {
        width: 100%;
        max-height: 250px;
        object-fit: cover;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .danger-zone {
        background: #fff5f5;
        border: 2px solid #fed7d7;
    }

    .danger-text {
        color: #c53030;
        font-size: 14px;
        margin: 10px 0 15px 0;
        line-height: 1.5;
    }

    .btn-danger {
        background: #dc3545;
        color: white;
    }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
</style>