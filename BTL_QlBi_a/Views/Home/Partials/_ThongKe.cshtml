@{
    var doanhThuThang = ViewBag.DoanhThuThang ?? 0m;
    var doanhThuHom = ViewBag.DoanhThuHomNay ?? 0m;
    var soHoaDon = ViewBag.SoHoaDon ?? 0;
    var khachMoi = ViewBag.KhachMoi ?? 0;
}

<div class="section-header">
    <h2 class="section-title">Thống kê & Báo cáo</h2>
    <div class="action-buttons">
        <button class="btn btn-success" onclick="exportReport()">📊 Xuất báo cáo</button>
    </div>
</div>

<div class="filter-bar">
    <div class="filter-row">
        <div class="filter-group">
            <span class="filter-label">Thời gian:</span>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="loadStats('today')">Hôm nay</button>
                <button class="filter-btn" onclick="loadStats('week')">Tuần này</button>
                <button class="filter-btn" onclick="loadStats('month')">Tháng này</button>
                <button class="filter-btn" onclick="loadStats('year')">Năm này</button>
            </div>
        </div>
        <div class="filter-group">
            <input type="date" class="search-input" id="dateFrom" placeholder="Từ ngày">
            <input type="date" class="search-input" id="dateTo" placeholder="Đến ngày">
            <button class="btn btn-primary" onclick="loadCustomRange()">Xem</button>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
    <div class="total-card">
        <div class="total-label">💰 Doanh thu hôm nay</div>
        <div class="total-amount">@doanhThuHom.ToString("N0")đ</div>
        <div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">↑ +12% so với hôm qua</div>
    </div>

    <div class="total-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
        <div class="total-label">📅 Doanh thu tháng</div>
        <div class="total-amount">@doanhThuThang.ToString("N0")đ</div>
        <div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">↑ +8% so với tháng trước</div>
    </div>

    <div class="total-card" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
        <div class="total-label">🧾 Số hóa đơn</div>
        <div class="total-amount">@soHoaDon</div>
        <div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">Hôm nay</div>
    </div>

    <div class="total-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
        <div class="total-label">👥 Khách mới</div>
        <div class="total-amount">@khachMoi</div>
        <div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">Tháng này</div>
    </div>
</div>

<!-- Chart Area -->
<div style="background: white; border-radius: 12px; padding: 20px; margin: 20px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
    <h3 style="margin-bottom: 20px; color: #1a1a2e;">📈 Biểu đồ doanh thu 7 ngày gần đây</h3>
    <div id="revenueChart" style="height: 300px; display: flex; align-items: flex-end; gap: 10px; justify-content: space-around;">
        @for (int i = 6; i >= 0; i--)
        {
            var date = DateTime.Now.AddDays(-i);
            var revenue = new Random().Next(500000, 2000000);
            var height = (revenue / 2000000.0) * 250;

            <div style="flex: 1; text-align: center;">
                <div style="background: linear-gradient(to top, #667eea, #764ba2); height: @(height)px; border-radius: 8px 8px 0 0; position: relative; transition: all 0.3s; cursor: pointer;"
                     onmouseover="this.style.opacity='0.8'"
                     onmouseout="this.style.opacity='1'"
                     title="@revenue.ToString("N0")đ">
                    <span style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600; color: #667eea;">
                        @((revenue / 1000).ToString("N0"))k
                    </span>
                </div>
                <div style="margin-top: 8px; font-size: 11px; color: #6c757d;">
                    @date.ToString("dd/MM")
                </div>
            </div>
        }
    </div>
</div>

<!-- Top Tables -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
    <div class="info-card">
        <h3 class="section-subtitle">🏆 Top bàn doanh thu cao</h3>
        <div style="margin-top: 15px;">
            @for (int i = 1; i <= 5; i++)
            {
                <div class="service-item">
                    <div class="service-info">
                        <div class="service-name">Bàn @i</div>
                        <div class="service-details">@(new Random().Next(10, 30)) lượt chơi</div>
                    </div>
                    <div class="service-price">@(new Random().Next(2000000, 5000000).ToString("N0"))đ</div>
                </div>
            }
        </div>
    </div>

    <div class="info-card">
        <h3 class="section-subtitle">⭐ Top dịch vụ bán chạy</h3>
        <div style="margin-top: 15px;">
            @{
                var services = new[] { "Coca Cola", "Sting", "Pepsi", "Nước suối", "Trà xanh" };
                foreach (var service in services)
                {
                    <div class="service-item">
                        <div class="service-info">
                            <div class="service-name">@service</div>
                            <div class="service-details">@(new Random().Next(50, 150)) ly</div>
                        </div>
                        <div class="service-price">@(new Random().Next(500000, 1500000).ToString("N0"))đ</div>
                    </div>
                }
            }
        </div>
    </div>
</div>

<!-- Time Analysis -->
<div class="info-card">
    <h3 class="section-subtitle">⏰ Phân tích theo khung giờ</h3>
    <div style="margin-top: 15px;">
        @{
            var timeSlots = new[] {
                new { Time = "06:00 - 09:00", Label = "Sáng sớm" },
                new { Time = "09:00 - 12:00", Label = "Buổi sáng" },
                new { Time = "12:00 - 14:00", Label = "Trưa" },
                new { Time = "14:00 - 18:00", Label = "Chiều" },
                new { Time = "18:00 - 22:00", Label = "Tối" },
                new { Time = "22:00 - 02:00", Label = "Đêm" }
                };

            foreach (var slot in timeSlots)
            {
                var percent = new Random().Next(30, 100);
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-weight: 600; font-size: 13px;">@slot.Time <span style="color: #6c757d;">(@slot.Label)</span></span>
                        <span style="font-weight: 700; color: #667eea;">@percent%</span>
                    </div>
                    <div style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: @(percent)%; transition: width 0.3s;"></div>
                    </div>
                </div>
            }
        }
    </div>
</div>

<script>
    function loadStats(period) {
        const buttons = document.querySelectorAll('.filter-bar .filter-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        alert('Đang tải thống kê: ' + period);
        // TODO: Load data via AJAX
    }

    function loadCustomRange() {
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;

        if (!dateFrom || !dateTo) {
            alert('Vui lòng chọn khoảng thời gian');
            return;
        }

        alert('Xem thống kê từ ' + dateFrom + ' đến ' + dateTo);
        // TODO: Load data via AJAX
    }

    function exportReport() {
        alert('Xuất báo cáo thống kê');
        // TODO: Generate and download report
    }
</script>